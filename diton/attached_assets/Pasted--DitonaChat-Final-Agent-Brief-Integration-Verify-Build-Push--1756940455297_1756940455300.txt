๐ DitonaChat โ Final Agent Brief (Integration โ Verify โ Build โ Push)
๐ ููุงุนุฏ ุงูุฃูุงู (ุตุงุฑูุฉ)

ุงูุนูู ููุท ุฏุงุฎู ุฃุญุฏุซ ูุฌูุฏ ูุทุงุจู ููููุท ./ditonachat_restored_* (ูุซู: ditonachat_restored_20250903-222559). ููููุน ููุณ ุงููุตุฏุฑ ุฏุงุฎู _ops/backups/....

ูุจู ุฃู ุชุนุฏูู: ุงูุณุฎ ุงููููุงุช ุงููุณุชูุฏูุฉ ุฅูู _ops/backups/agent_fix_<UTC>/....

ุฃู ููู ููุฌูุฏ ููุง ูุญูู ุชุนูููุงุช // DitonaChat: ูุชุญุชุงุฌ ุชุนุฏููู:

ุงุนูู diff ุฏุงุฎููุ ูุฃุฏุฑุฌ ุงูุชุนุฏูู ูุญุฏู ุฃุฏูู ุฏุงุฎู ุฃูุฑุจ overlay/ุญุงููุฉ ููุงุณุจุฉ.

ูู ูุฌุฏุชู ุบููุถูุง ูุฏ ูุคุซูุฑ ุนูู ููุทู ุงููุณุชุฎุฏู โ ุชูููู ูุงุทุจุน Acceptance ููู ุณุจุจ ุงูุชูููู.

ูุง ุฃุณุฑุงุฑ ูู Git. .gitignore ูุฌุจ ุฃู ูุญุฌุจ: .env, .env.local, .next/, dist/, _ops/artifacts/, _ops/backups/, node_modules/.

ุงูุณูุฑุจุช Idempotent: ุฅู ูุงูุช ุงูููุฒุฉ ููุฌูุฏุฉุ ุชุฎุทูููุง ุจุฏูู ุชุนุฏูู.

ุงููุฑุญูุฉ 0 โ ุงูุงูุชุดุงู ูุงูุชุญููู (ูุฑุงุกุฉ ููุท)

ุญุฏูุฏ ุฃุญุฏุซ ูุฌูุฏ ditonachat_restored_*ุ ูุงุนุชุจุฑู ROOT.

ุงุทุจุน Acceptance ุฃููู (READ-ONLY):

-- Acceptance --
STAGE=0_DISCOVERY
RESTORED_DIR=<ROOT>
FILES=page.tsx:<0/1>,ChatClient.tsx:<0/1>,ChatMessages.tsx:<0/1>,media-bridge.ts:<0/1>,webrtc.ts:<0/1>,PeerMeta.tsx:<0/1>,gender.ts:<0/1>,countries.ts:<0/1>
CHAT_MESSAGES_SLICE_MINUS_3_LINE=<number or UNKNOWN>
MEDIA_THRESHOLDS=H80:<0/1>/V50:<0/1>
WEBRTC_AUTONEXT_LINES=<csv or UNKNOWN>
HOME_BG_HERO_WEBP_USAGE=<hits 0+>
LEGAL_PAGES=terms:<0/1> privacy:<0/1> dmca:<0/1> content:<0/1> abuse:<0/1> 2257:<0/1>
QUICK_DOCK_ANCHOR_LINE=<number or 0>
ENDPOINTS=/_health:<0/1>,/api/monitoring/metrics:<0/1>,/api/turn:<0/1>,/api/stripe/prices:<0/1>,/api/stripe/subscribe:<0/1>,/api/stripe/portal:<0/1>,/api/age/allow:<0/1>,/api/stripe/webhook:<0/1>
NOTES=Discovery done; proceeding to patch missing items
-- End Acceptance --


ูุชูููุน: PeerMeta/gender/countries ูุงูุตูุญุงุช ุงููุงููููุฉ ุบูุฑ ููุฌูุฏุฉุ ุงูุฎูููุฉ ูุฏ ุชููู ุบูุฑ ููุนูุฉ.

ุงููุฑุญูุฉ 1 โ ุงุณุชููุงู ุงูููุงูุต (ุฅูุดุงุก/ุฏูุฌ)

ูุณุฎ ุงุญุชูุงุทู ูุจู ูู ููู. ุฅู ููุฌุฏ ุงูููู ูุจุฏูู ุนูุงูุงุช // DitonaChat:: ุฃุฏุฎูู ุฃูู ุชุนุฏูู ููููุ ูู ุฎุทุฑ ุชุนุงุฑุถ ููุทูู โ ุชูููู ุจูAcceptance.

gender.ts (src/utils/gender.ts)

ุฅู ูู ููุฌุฏ: ุฃูุดุฆู ุจุชุนูููุงุช ูุงุถุญุฉ:

type Gender = 'male'|'female'|'couple'|'lgbt'|'unknown'

ุฎุฑุงุฆุท: GENDER_ICON, GENDER_LABEL, GENDER_CLASSES (Tailwind-ready)

ุงูุฃููููุงุช: โ, โ, ๐, ๐, โข

DitonaChat markers: // DitonaChat: BEGIN gender-utils โฆ END

countries.ts (src/data/countries.ts)

ุฅู ูู ููุฌุฏ: ุฃูุดุฆู ุจูุงุฆูุฉ 247 ุฏููุฉ (ุงุณุชุจุนุฏ GS, KP, MVุ ูุงุณูุญ ุจูXK Kosovo).

ุตุฏูุฑ COUNTRIES ูุฏูุงู: codeToName(code), allCodes().

ุถุน DitonaChat markers.

PeerMeta.tsx (src/components/chat/PeerMeta.tsx)

ุฅู ูู ููุฌุฏ: ุฃูุดุฆู ููููู React ูุนุฑุถ ุฃุณูู ูุณุงุฑ ุงููุณู ุงูุนููู: Country ยท City + Badge ุงูุฌูุณ (ุฃููููุฉ/ููู ูู gender.ts)ุ ููุงุณ: absolute left-3 bottom-3 z-[40] pointer-events-none ูุน ุฎูููุฉ ุดุจู ุดูุงูุฉ.

DitonaChat markers.

ุฏูุฌ PeerMeta ูู ChatClient.tsx

ูุฏู ุงูุฏูุฌ: ุฅุฏุฑุงุฌ <PeerMeta country={...} city={...} gender={...} /> ุฏุงุฎู ุทุจูุฉ overlay ุฃุนูู ุงูููุฏูู/ููุญุฉ ุงููุธูุฑ ุจุฏูู ุชุบููุฑ ููุทู ุงููุณุชุฎุฏู.

ุงูุฎูุงุฑุฒููุฉ (ุบูุฑ ูุฏููุฑุฉ):

ุงุณุชูุฑุฏ: import { PeerMeta } from '@/components/chat/PeerMeta' (ุฃู ุงููุณุงุฑ ุงููุณุจู ุงูุตุญูุญ).

ุงุจุญุซ ุนู ุงูุญุงููุฉ ุงูุนููุง (video/grid/overlay).

ุฅู ูุงูุช ููุงู ุทุจูุฉ overlay ูุทุงุจูุฉุ ุฃุฏุฑูุฌ <PeerMeta โฆ/> ุจุฏุงุฎููุง.

ุฅู ูู ุชูุฌุฏ ุทุจูุฉ overlayุ ุฃูุดุฆ ุบูุงู <div className="absolute inset-0 pointer-events-none"> ูุฃุฏุฑูุฌ ุฏุงุฎูู ุงูุนูุตุฑ ูุน left-3 bottom-3 z-[40].

ูุตุฏุฑ ุงูุจูุงูุงุช: ุงุณุชุฎุฏู ูุง ูุชูููุฑ ูู state/props (peer/candidate). ุนูุฏ ุนุฏู ูุฌูุฏูุงุ ูุฑูุฑ ููููุง ูุงุฑุบุฉ (ูู ุชูุณุฑ ุงูุจูุงุก) ูุงูุชุจ ุชุนููู // TODO: wire peer meta @runtime.

ูุง ุชุบููุฑ ุฃู ููุทู ุขุฎุฑ ุฃู ุชุฑุชูุจ ุฃุฏูุงุช ุงููุณุชุฎุฏู.

ุฃุถู ุชุนููู // DitonaChat: BEGIN peer-meta mount โฆ END.

ุงูุฎูููุฉ ูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ (src/app/page.tsx)

ุงุฑุจุท /hero.webp.webp ุนูู <main> ุจููุงุณุงุช Tailwind:
bg-[url('/hero.webp.webp')] bg-cover bg-center bg-no-repeat

ุฅู ูุงู ููุงู className ููุฌูุฏ: ุฃูุญููู. ูุฅูุง ุฃุถูู ูุงุญุฏูุง.

DitonaChat markers.

thresholds (src/utils/media-bridge.ts)

ุชุฃููุฏ H=80 ูV=50. ุฅู ุงุฎุชููุช: ุญุฏูุซ ุงูููู ูุฃุถูู ุชุนููู // DitonaChat: gesture thresholds.

auto-next (src/utils/webrtc.ts)

ุชุฃููุฏ ูุฌูุฏ busEmit('next') (ุฃู "next") ุนูุฏ ุญุงูุงุช: failed, disconnected, closed (ูุฃูุถูุง hangup ุฅู ููุฌุฏ).

ุฅู ูู ุชููุฌุฏ:

ุฃุถูู import { busEmit } from './bus' ุฅู ูุฒู.

ุฃุถูู ุงุณุชุฏุนุงุกุงุช busEmit('next') ูุน debounce ุฏุงุฎูู (ูุซูุงู 1000ms) ูููุน ุงูุชูุฑุงุฑ.

DitonaChat markers ุญูู ุงููุชู ุงููุถุงูุฉ.

Quick Dock anchor

ุชุฃููุฏ ูุฌูุฏ ุนูุตุฑ ุจููุงุณุงุช: className="absolute right-3 -top-24 z-[40]".

ุฅู ูู ููุฌุฏ: ุฃุถููู ูู ุงูููุถุน ุงูุตุญูุญ ููู ุงููุคููุ ุจุฏูู ุชุบููุฑ ุงููุณุงุฑุงุช ุฃู ุชุฑุชูุจ ุงูุฃุฏูุงุช.

ุงูุตูุญุงุช ุงููุงููููุฉ ุงูุณุชุฉ

ุฃูุดุฆ (ุฅู ูู ุชูุฌุฏ):

src/app/terms/page.tsx

src/app/privacy/page.tsx

src/app/dmca/page.tsx

src/app/content/page.tsx

src/app/abuse/page.tsx

src/app/2257/page.tsx

ูุญุชูู ุฅูุฌููุฒู ุจุณูุท ุนููุงูู ูุงุถุญ ูุฑูุงุจุท ุชูููู ุฎูููุฉ.

ุฃุฒู ุฃู ุชูุฑุงุฑ route groups ููุฐู ุงูุตูุญุงุช (ูุง ูุณุฎ ุชุญุช (legal) ุฅูุฎ). ูุณุฎุฉ ูุงุญุฏุฉ ูุจุงุดุฑุฉ ููู ูุณุงุฑ.

ุจุนุฏ ุฅููุงู ุงููุฑุญูุฉ 1 ุงุทุจุน:

-- Acceptance --
STAGE=1_PATCH
RESTORED_DIR=<ROOT>
ADDED_OR_UPDATED=[gender.ts:<0/1>,countries.ts:<0/1>,PeerMeta.tsx:<0/1>,ChatClient.mount:<0/1>,home_bg:<0/1>,thresholds:<0/1>,autonext:<0/1>,quick_dock:<0/1>,legal_pages:<0..6>]
NOTES=Patched missing items with DitonaChat markers where applicable
-- End Acceptance --

ุงููุฑุญูุฉ 2 โ ุชุญููู ุดุงูู (ูุฑุงุกุฉ ููุท)

ุชุญูู ูู ูู ุงูุจููุฏุ ูุงุทุจุน:

-- Acceptance --
STAGE=2_VERIFY
RESTORED_DIR=<ROOT>
FILES=page.tsx:1,ChatClient.tsx:1,ChatMessages.tsx:1,media-bridge.ts:1,webrtc.ts:1,PeerMeta.tsx:1,gender.ts:1,countries.ts:1
HOME_BG_HERO_WEBP_USAGE=1
CHAT_MESSAGES_SLICE_MINUS_3_LINE=<number>
MEDIA_THRESHOLDS=H80:1/V50:1
WEBRTC_AUTONEXT_LINES=<csv numbers>
PEER_META=EXISTS:1 MOUNTED:1 STYLE_BOTTOM_LEFT:1
GENDER_ICONS=male:1 female:1 couple:1 lgbt:1 unknown:1
COUNTRIES_FILE=src/data/countries.ts
COUNTRIES_COUNT=247
LEGAL_PAGES=terms:1 privacy:1 dmca:1 content:1 abuse:1 2257:1
ENDPOINTS=/_health:1,/api/monitoring/metrics:1,/api/turn:1,/api/stripe/prices:1,/api/stripe/subscribe:1,/api/stripe/portal:1,/api/age/allow:1,/api/stripe/webhook:1
QUICK_DOCK_ANCHOR_LINE=<number or fixed>
NOTES=All required features present and verified
-- End Acceptance --


ุฅุฐุง ุฃู ุฑูู/ูููุฉ ููุณุช ููุง ูู ูุชููุนุ ุฃุตููุญูุง ุซู ุฃุนูุฏ ุทุจุงุนุฉ Acceptance.

ุงููุฑุญูุฉ 3 โ Build ูุญูู (Node 20)

ุงุณุชุฎุฏู Node 20.

ูููุฐ: npm ci && npm run build

ุฃุตููุญ ุฃู ุชุญุฐูุฑ route duplication ููุตูุญุงุช ุงููุงููููุฉ ุจุฅุฒุงูุฉ ุงููุณุฎ ุงูุฒุงุฆุฏุฉ (ุงุจูู ุงููุณุงุฑ ุงููุจุงุดุฑ).

ุงุทุจุน:

-- Acceptance --
STAGE=3_BUILD
RESTORED_DIR=<ROOT>
BUILD_RC=0
NEXT_VERSION=<detected or UNKNOWN>
ROUTES_OK=1
NOTES=standalone output ready
-- End Acceptance --


ุฅู ูุดู ุงูุจูุงุกุ ุฃุตููุญ ุซู ุฃุนุฏ ุงููุญุงููุฉ ุญุชู BUILD_RC=0.

ุงููุฑุญูุฉ 4 โ Git ุฅุนุฏุงุฏ ูุฏูุน ุฅูู GitHub

ุงูุฌุฐุฑ: ููุณ <ROOT>.

.gitignore ูุฌุจ ุฃู ูุญุชูู:
.env, .env.local, .next/, dist/, _ops/artifacts/, _ops/backups/, node_modules/

ุงุฑุจุท ุงูุฑูููุช: https://github.com/Alshughriahmed/projeckt.git

ุงุฏูุน ุฅูู main (ุงููุณุชูุฏุน ููุฌูุฏ ูููุจู FF).

ุงุทุจุน:

-- Acceptance --
STAGE=4_PUSH
ROOT=<ROOT>
GIT_REMOTE=https://github.com/Alshughriahmed/projeckt.git
PUSHED_BRANCH=main
LAST_COMMIT_SHA=<7>
TREE_TOP_LEVEL=[src, package.json, tsconfig.json, next.config.mjs, .replit, _ops, public]
PUSH_RESULT=OK
-- End Acceptance --

ุงููุฑุญูุฉ 5 โ ุชูุฑูุฑ ููุงุฆู

ุฃูุดูุฆ: _ops/reports/AGENT_FINAL_<UTC>.md ูุชุถููู:

ูุงุฆูุฉ ุงููููุงุช ุงูููุถุงูุฉ/ุงููุนุฏููุฉุ ูุน ุณุทูุฑ DitonaChat markers.

COUNTRIES_COUNT ูุนูููุฉ ุฑููุฒ (ูุซูุงู: US, DE, FR, XKโฆ).

ุฃุฑูุงู ุณุทูุฑ busEmit('next').

ูุชูุฌุฉ BUILD ููุณุฎุฉ Next ุฅู ุฃููู.

ุฑุงุจุท ุงูุฑูููุช ูุงูููููุช ุงูููุงุฆู.
ูุงุทุจุน:

-- Acceptance --
STAGE=5_REPORT
REPORT=_ops/reports/AGENT_FINAL_<UTC>.md
NOTES=Done
-- End Acceptance --

ููุงุญุธุงุช ูููุฉ

ูุง ุชุบููุฑ ุฃู ููุทู ุฎุงุฑุฌ ููุทุงุช ุงูุฅุฏุฑุงุฌ ุงููุทููุจุฉ (PeerMeta/ุงูุฎูููุฉ/thresholds/auto-next/anchor/ุงูุตูุญุงุช).

ูุง ุชุญุฐู ุฃู ุชุนุฏูู ุดูุฆูุง ูู _ops/backups/ ุงููุตุฏุฑ.

ุนูุฏ ุงูุดูู ูู ููุถุน ุฅุฏุฑุงุฌ <PeerMeta /> ุฏุงุฎู ChatClient.tsxุ ุงุฎุชุฑ overlay ููุงุตู ูููุทูุฉ ุงูููุฏูู ุจุญูุซ ูุง ูุญุฌุจ ุนูุงุตุฑ ุงูุชุญูู (ูุงุณุชุฎุฏู pointer-events-none).

ุฃู ุชุนุงุฑุถ ุฃู ุบููุถ: ุชูููู ูุงุทุจุน Acceptance ูุดุฑุญ ุงูุณุจุจ.