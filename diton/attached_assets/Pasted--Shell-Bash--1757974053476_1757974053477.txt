المشكلة: اختفاء شاشة الـShell وفتح شاشة/جلسة جديدة أثناء تنفيذ سكربتات Bash، مما يفقدنا السجل ويؤدي لتكرار نفس السكربتات.

السياق:

مشروع Next.js 15 (App Router) + TypeScript على Replit.

ننفّذ سكربتات Bash من تبويب Shell فقط. السكربتات تعدّل ملفات، تُجري pnpm build, git, وcurl، وتكتب تقارير إلى _ops/reports/*.log و*.accept.

نستخدم tee لتثبيت المخرجات، وأحيانًا timeout وstdbuf. لا نشغّل pnpm dev داخل السكربتات.

الأعراض القابلة لإعادة الإنتاج:

أبدأ سكربت طويل (يبني أو يجري اختبارات HTTP). بعد ثوانٍ إلى دقيقة:

تختفي المخرجات من الشاشة.

تظهر شاشة/جلسة جديدة بسطر فارغ، كأن التيرمنال أعيد تهيئته.

أحيانًا تظهر أجزاء من السجل ثم تختفي.

بعد ذلك أضطر لإعادة السكربت خوفًا من أنه لم يكتمل، ما يسبب ازدواجية تنفيذ.

ما جرّبناه:

إضافة heartbeat يطبع [HB] HOLD كل 3 ثوانٍ.

تكرار طباعة ملف القبول .accept عدة مرات بنهاية السكربت.

توجيه المخرجات إلى ملف + tee.
الظاهرة ما زالت تحدث متقطعًا، خصوصًا عند pnpm build أو عند فيض مخرجات curl.

ماذا نحتاج:

تفسير جذري: لماذا تُمسح شاشة Shell أو تُستبدل بجلسة جديدة تلقائيًا أثناء تنفيذ سكربت واحد؟

هل هناك آلية auto-clear/auto-attach في Replit عند انتهاء مهمة/اكتشاف عملية Node/Next؟

هل تغييرات الملفات أثناء البناء تسبب إعادة تهيئة بيئة الـShell؟

هل هناك حدّ وقت/ذاكرة يؤدي لإعادة تشغيل الحاوية/الطرفية؟

طريقة مدعومة رسميًا لمنع فقدان العرض:

إعداد أو خيار لتعطيل أي auto-clear أو auto-restart للـShell؟

توصية باستخدام Terminal بديلًا عن Console أو العكس؟

استخدام tmux أو ما يعادله في Replit؟ وهل هو متاح؟

نمط تشغيل موصى به للسكربتات الطويلة على Replit:

هل يُفضّل تشغيلها عبر bash -lc أو nohup + tail -f؟

هل هناك حدود على stdout تسبب إعادة تهيئة الواجهة؟

منع التكرار بعد الانقطاع:

أفضل ممارسة لقفل idempotent: هل flock متاح؟ أو بديل توصون به على Replit؟

هل هناك مكان معياري لملف قفل (lockfile) لا يُمسح بين جلسات؟

نقاط تقنية لتأكيدها:

كيف نضمن أن سكربت واحد يعمل مرة واحدة فقط حتى لو أُعيد رسم الشاشة؟

هل يمكن تعطيل أي “autostart on file change” يؤثر على الـShell؟

هل توجد إعدادات Workspace يجب تغييرها لتثبيت سلوك الطرفية؟

إن احتجتم تشخيصًا إضافيًا، أخبرونا:

سنرسل لقطات قصيرة من السجلات تحت _ops/reports/، وأسماء السكربتات التي يظهر عندها الانقطاع (pnpm build, curl probe loops، إلخ).

نريد حلاً ثابتًا يمنع اختفاء المخرجات ويضمن عدم تكرار السكربتات، مع أقل تغييرات ممكنة على بيئة Replit.