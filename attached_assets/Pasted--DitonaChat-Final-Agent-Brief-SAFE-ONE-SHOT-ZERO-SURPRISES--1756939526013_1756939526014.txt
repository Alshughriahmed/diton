๐ฏ DitonaChat โ Final Agent Brief (SAFE, ONE-SHOT, ZERO-SURPRISES)
ุญุฏูุฏ ุงูุฃูุงู (ูุง ุชูุฎุงูููุง)

ูุง ุชููุณ ูุตุฏุฑ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ ุชุญุชู _ops/backups/โฆ ุฅุทูุงููุง. ุงูุนูู ูููู ููุท ุนูู ูุณุฎุฉ ูุณุชุนุงุฏุฉ.

Idempotent ุจุงููุงูู: ูู ุฎุทูุฉ ุชุชุญูู ุฃูููุงุ ูุฅู ูุงูุช ูุทุจููุฉ ุชุชุฎุทูู ุจุฏูู ุชุนุฏูู.

ูุณุฎ ุงุญุชูุงุทู ูุจู ุฃู ุชุนุฏูู ุฅูู: _ops/backups/agent_fix_<UTC>/โฆ.

ูุดู ุงูุชุนุงุฑุถ: ุฅุฐุง ูุฌุฏุช ุฃู ููู ูุฏู ููุฌูุฏ ููุญุชูุงู ูุฎุชูู ููุง ุชูุฌุฏ ุนูุงูุงุชูุง // DitonaChat:ุ ุชูููู ูุงุทุจุน ุณุจุจ ุงูุชููู ูู Acceptance ููุง ุชูููู.

ูุง ุฃุณุฑุงุฑ ูู Git. .gitignore ูุฌุจ ุฃู ูุญุฌุจ: .env, .env.local, .next/, dist/, _ops/artifacts/, _ops/backups/, node_modules/.

ุงููุฑุญูุฉ 0 โ ุงูุชุดุงู ูุณุฎุฉ ุงูุนูู ูุงูุชุญููู (ูุฑุงุกุฉ ููุท)

ุงุจุญุซ ุนู ุฃุญุฏุซ ูุฌูุฏ ูุทุงุจู ููููุท ./ditonachat_restored_*. ุฅู ูู ููุฌุฏุ ุชูููู ูุน Acceptance=FAIL.

ุงุนูู ููู ููุท. ุงุทุจุน Acceptance ุฃููู ููู:

RESTORED_DIR

ูุฌูุฏ ุงููููุงุช: page.tsx, ChatClient.tsx, ChatMessages.tsx, media-bridge.ts, webrtc.ts, PeerMeta.tsx, gender.ts, countries.ts

CHAT_MESSAGES ููู slice(-3) (ุฑูู ุงูุณุทุฑ)

thresholds ูู media-bridge.ts: H=80 ูV=50

ุณุทูุฑ busEmit('next') ูู webrtc.ts

ุงุณุชุฎุฏุงู ุงูุฎูููุฉ /public/hero.webp.webp ูู page.tsx

ุงูุตูุญุงุช ุงููุงููููุฉ ุงูุณุชุฉ: terms, privacy, dmca, content, abuse, 2257

ุงููAPI routes presence: /_health, /api/monitoring/metrics, /api/turn, /api/stripe/{prices,subscribe,portal,webhook}, /api/age/allow

ูุฌูุฏ Quick Dock anchor: className="absolute right-3 -top-24 z-[40]"

ุชูููุนู: ุณุชุฌุฏ ุฃู PeerMeta.tsx, gender.ts, countries.ts, ุงูุฎูููุฉุ thresholdsุ auto-nextุ ุงูุตูุญุงุช ุงููุงููููุฉ ูุงูุตุฉ/ุบูุฑ ูุทุจููุฉ.

ุงููุฑุญูุฉ 1 โ ุฅูุดุงุก/ุงุณุชููุงู ุงููููุงุช ุงููุงูุตุฉ (ุจุฏูู ุชุนุงุฑุถ)

ูุจู ูู ููู: ุฅู ูุงู ุงูููู ููุฌูุฏูุง ููุญุชูุงู ูุง ูุชุถูู ุชุนูููุงุชูุง // DitonaChat:, ุชูููู ูุงุทุจุน Conflict ูู Acceptance.

src/utils/gender.ts

ุฃูุดุฆ ุฎุฑูุทุฉ ุงูุฃููุงุน ุงูุฎูุณุฉ ุจุงูุฃููููุงุช ูุงูุฃููุงู:

male โุ female โุ couple ๐ุ lgbt ๐ุ unknown โข

ุตุฏูุฑ:

type Gender = 'male'|'female'|'couple'|'lgbt'|'unknown'

GENDER_ICON[gender], GENDER_LABEL[gender], GENDER_CLASSES[gender] (Tailwind-ready)

ุถุน ุชุนููู: // DitonaChat: BEGIN gender-utils โฆ END.

src/data/countries.ts

ุฃูุดุฆ ูุตูููุฉ ุฏูู ุดุงููุฉ ูุน ุงุณุชุจุนุงุฏ: GS, KP, MV (ููุง ุทูุจ ุงููุงูู)ุ ูุงูุณูุงุญ ุจูXK (Kosovo).

ุงููุฏู ุงูุนุฏุฏู ูู ุงูุชุญูู: COUNTRIES_COUNT=247.

ุตุฏูุฑ: COUNTRIES, ูุฏูุงู: codeToName(code), allCodes().

src/components/chat/PeerMeta.tsx

ููููู React ูุนุฑุถ ุฃุณูู ูุณุงุฑ ุงููุณู ุงูุนููู: Country ยท City + Badge ุฌูุณ (ุฃููููุฉ + ููู ูู GENDER_*).

props: { country?: string; city?: string; gender?: Gender }.

ุชุตููู ุซุงุจุช: ุญุงููุฉ ุตุบูุฑุฉ ุดุจู ุดูุงูุฉุ tailwind classes ููุงุณุจุฉุ pointer-events-noneุ z-40.

ุชุนููู ูุงุถุญ: // DitonaChat: BEGIN peer-meta.

ุฏูุฌ PeerMeta ูู src/app/chat/ChatClient.tsx

ุฃุถูู ุงูุงุณุชูุฑุงุฏ ูุงูุงุณุชุฎุฏุงู ุฏุงุฎู overlay ุฃุนูู ุงูููุฏูู/ุงูููุญุฉุ ูุน className="absolute left-3 bottom-3 z-[40]".

ุงูุจูุงูุงุช: ุงุณุชุนูู ูุง ูู ูุชุงุญ ูู ุญุงูุฉ ุงููุทุงุจูุฉ/peer (country/city/gender). ุฅู ูู ุชูุฌุฏุ ูุฑูุฑ ููููุง ุงูุชุฑุงุถูุฉ ุขููุฉ (ูุงุฑุบุฉ) โ ููู ูุง ุชูุณูุฑ ุงูุจูุงุก.

ุงูุฎูููุฉ ูู src/app/page.tsx

ุงุฑุจุท /public/hero.webp.webp ุนูู <main> ุจุงุณุชุฎุฏุงู Tailwind (bg-[url('/hero.webp.webp')] bg-cover bg-center ุฅูุฎ).

ูุง ุชุบููุฑ ุจููุฉ ุงูุตูุญุฉ ุฃู ูุตูุตูุง.

thresholds ูู src/utils/media-bridge.ts

ุนุฑูู ุซูุงุจุช ูุงุถุญุฉ: export const H = 80; export const V = 50; ุฃู ูุง ูุนุงุฏููุง ุฏุงุฎู ุงูููุทู.

ุฃุถู ุชุนููู // DitonaChat: gesture thresholds.

Auto-next ูู src/utils/webrtc.ts

ุถููู import { busEmit } from './bus' ุฅู ููุฌุฏ ุงููbus.

ูู callbacks ุฃู ุญุงูุงุช peerConnection: ุนูุฏ failed, disconnected, closed (ูุฃูุถูุง hangup ุฅู ููุฌูุฏ):

ูููุฐ busEmit('next') ูุน debounce ุฏุงุฎูู (ุญุฏ ุฃุฏูู 1000ms ุจูู ุงุณุชุฏุนุงุก ูุขุฎุฑ) ูููุน ุงูุงูุฏูุงุน.

ูุง ุชุบููุฑ ุณููููุง ุขุฎุฑ.

Quick Dock anchor

ุชุฃูุฏ ูู ูุฌูุฏ ุงูุนูุตุฑ ุจููุงุณุงุช: absolute right-3 -top-24 z-[40]. ุฅู ูู ููุฌุฏุ ุฃุถููู ูู ุงูููุถุน ุงูุตุญูุญ ููู ุงููุคูู.

ุงูุตูุญุงุช ุงููุงููููุฉ ุงูุณุชุฉ

ุฃููุดุฆ:
src/app/terms/page.tsx, src/app/privacy/page.tsx, src/app/dmca/page.tsx,
src/app/content/page.tsx, src/app/abuse/page.tsx, src/app/2257/page.tsx

ูุญุชูู ุจุณูุท ููุณูู (ุฅูุฌููุฒู) ูุน ุนูุงููู ูุงุถุญุฉ ูุฑูุงุจุท ุชูููู ุฎูููุฉ.

ุฅุฒุงูุฉ ุฃู ุชูุฑุงุฑ ูู ูุฌููุนุงุช ูุณุงุฑุงุช (Route Groups) ุชุคุฏู ูููุณ ุงููุณุงุฑ (ุณุจุจ ุฎุทุฃ ุงูุจูุงุก ุงูุฐู ุธูุฑ ุณุงุจููุง). ูุฌุจ ุฃู ุชุจูู ูุณุฎุฉ ูุงุญุฏุฉ ููู ุตูุญุฉ ุชุญุช ุงููุณุงุฑ ุงููุจุงุดุฑ (ุจุฏูู (legal) ูุฒุฏูุฌ).

ููู ุจูุฏ ุฃุนูุงู: ุงูุณุฎ ุงูุฃุตู ุฅูู _ops/backups/agent_fix_<UTC>/โฆ ูุจู ุงูุชุนุฏููุ ุซู ุทุจูู ุงูุชุบููุฑ.

ุงููุฑุญูุฉ 2 โ ุชุญูู ุดุงูู (READ-ONLY)

ูููุฐ ูุญุตูุง ุดุงูููุง ูุงุทุจุน:

-- Acceptance --
RESTORED_DIR=<path>
FILES=page.tsx:1,ChatClient.tsx:1,ChatMessages.tsx:1,media-bridge.ts:1,webrtc.ts:1,PeerMeta.tsx:1,gender.ts:1,countries.ts:1
HOME_BG_HERO_WEBP_USAGE=1
CHAT_MESSAGES_SLICE_MINUS_3_LINE=<number>
MEDIA_THRESHOLDS=H80:1/V50:1
WEBRTC_AUTONEXT_LINES=<lineNumbersCSV>
PEER_META=EXISTS:1 MOUNTED:1 STYLE_BOTTOM_LEFT:1
GENDER_ICONS=male:1 female:1 couple:1 lgbt:1 unknown:1
COUNTRIES_FILE=src/data/countries.ts
COUNTRIES_COUNT=247
LEGAL_PAGES=terms:1 privacy:1 dmca:1 content:1 abuse:1 2257:1
ENDPOINTS=/_health:1,/api/monitoring/metrics:1,/api/turn:1,/api/stripe/prices:1,/api/stripe/subscribe:1,/api/stripe/portal:1,/api/age/allow:1,/api/stripe/webhook:1
QUICK_DOCK_ANCHOR_LINE=<number>
NOTES=All feature gaps filled
-- End Acceptance --


ุฅุฐุง ุฃู ูููุฉ ููุณุช ููุง ูู ูุชููุนุ ุชูููู ูุงุทุจุน ูุง ุงูุฐู ุงุฎุชูู.

ุงููุฑุญูุฉ 3 โ Build ูุญูู ููุญูุต

ุงุณุชุฎุฏู Node 20.

npm ci && npm run build

ุฅู ุธูุฑุช ุฃุฎุทุงุก route duplication ููุตูุญุงุช ุงููุงููููุฉุ ุฃุตููุญูุง ุจุฅุฒุงูุฉ ุงููุณุฎ ุงูููุฑุฑุฉ (ุงุญุชูุธ ููุท ุจุงููุณุงุฑุงุช ุงููุจุงุดุฑุฉ).

ุงุทุจุน Acceptance:

-- Acceptance --
BUILD_RC=0
NEXT_VERSION=<>
ROUTES_OK=1
NOTES=standalone output ready
-- End Acceptance --

ุงููุฑุญูุฉ 4 โ Git ุฅุนุฏุงุฏ ูุฏูุน ุฅูู GitHub

ุงูุฌุฐุฑ: ููุณ RESTORED_DIR.

.gitignore ูุฌุจ ุฃู ูุญุชูู:
.env, .env.local, .next/, dist/, _ops/artifacts/, _ops/backups/, node_modules/

ุงุฑุจุท ุงูุฑูููุช: https://github.com/Alshughriahmed/projeckt.git

ุงุฏูุน ุฅูู main (ุงููุณุชูุฏุน ุฌุฏูุฏ ููุงุฑุบ ุชูุฑูุจูุง ูู ูุจููุงุ ุงูุฏูุน ูุฌุจ ุฃู ูููู Fast-Forward).

Acceptance:

-- Acceptance --
ROOT=<RESTORED_DIR>
GIT_REMOTE=https://github.com/Alshughriahmed/projeckt.git
PUSHED_BRANCH=main
LAST_COMMIT_SHA=<7>
TREE_TOP_LEVEL=[src, package.json, tsconfig.json, next.config.mjs, .replit, _ops, public]
PUSH_RESULT=OK
-- End Acceptance --

ุงููุฑุญูุฉ 5 โ ุชูุฑูุฑ ููุงุฆู

ุฃูุดุฆ ููู ุชูุฑูุฑ: _ops/reports/AGENT_FINAL_<UTC>.md ููุฎูุต:

ูุง ุฃูุถูู/ุนูุฏูู (ููุงุฆู ุงููููุงุชุ diff ูุฎุชุตุฑ).

COUNTRIES_COUNT ูุนูููุฉ ุฑููุฒ.

ุณุทูุฑ busEmit('next').

ูุชูุฌุฉ build.

ุฑุงุจุท ุงูุฑูููุช ูุงูููููุช.

ุฃุฑููู ุงููุณุงุฑ ูู ุงูููุงูุฉุ ูุงุทุจุน Acceptance ุตุบูุฑ:

-- Acceptance --
REPORT=_ops/reports/AGENT_FINAL_<UTC>.md
NOTES=Done
-- End Acceptance --

ููุงุญุธุงุช ุฎุชุงููุฉ ูููููู

ุฃู ุชุนุงุฑุถ (ููู ููุฌูุฏ ููุญุชูุงู ูุฎุชูู ููุง ุชูุฌุฏ ุนูุงูุงุช // DitonaChat:) โ ูุง ุชูุตูููุญ ุชููุงุฆููุง. ุชูููู ูุงุทุจุน ุชูุงุตูู ุงูุชุนุงุฑุถ (ุงููุณุงุฑ + ุชุฌุฒุฆุฉ sha256) ูู Acceptance.

ูุง ุชูุฏุฎู/ุชุนุฏูู ุฃู ุดูุก ุฎุงุฑุฌ ุงูุจููุฏ ุงููุญุฏูุฏุฉ ุฃุนูุงู.

ุงููุฏู ุฃู ููุชูู ุงููุดุฑูุน ูุทุงุจููุง ููููุงุตูุงุช ุงูุชู ุตุงุฏู ุนูููุง ุงููุงููุ ูุน Build ูุงุฌุญุ ุซู ุฏูุน ุฅูู GitHub.