Ø¥Ø·Ø§Ø± Ø§Ù„Ø¹Ù…Ù„

ÙØ±Ø¹ Ø¬Ø¯ÙŠØ¯ Ù„ÙƒÙ„ Ø­Ø²Ù…Ø© ØªØºÙŠÙŠØ±Ø§Øª.

Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ ØªØ­Øª _ops/backups/â€¦.

Ù„Ø§ ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù„Ù‰ Vercel Ø£Ùˆ Google Console. Ø¥Ù† Ù„Ø²Ù… Ù…ØªØºÙŠÙ‘Ø± ENV Ù…ÙÙ‚ÙˆØ¯ØŒ Ø§Ø·Ø¨Ø¹ Ø§Ø³Ù…Ù‡ ÙÙ‚Ø·.

Ù„Ø§ ØªØºÙŠÙŠØ±Ø§Øª ÙˆØ§Ø³Ø¹Ø©. Ø£Ù‚Ù„ ØªØ¹Ø¯ÙŠÙ„ ÙŠØ­Ù‚Ù‚ Ø§Ù„Ù‚Ø¨ÙˆÙ„.

Ø´ØºÙ‘Ù„ ÙƒÙ„ Ø³ÙƒØ±Ø¨Øª Ø¹Ø¨Ø±: bash _ops/bin/ops_run.sh ./<script>.sh

Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù‚Ø¨ÙˆÙ„

Auth:
/api/auth/providers ØªÙØ±Ø¬Ø¹ JSON ØºÙŠØ± ÙØ§Ø±Øº.
/api/auth/signin = 200/302 ÙˆÙŠØ¶Ø¨Ø· next-auth.csrf-token.
Header ÙŠØ¹Ø±Ø¶ Login/Sign out Ø­Ø³Ø¨ Ø§Ù„Ø¬Ù„Ø³Ø©.

Stripe:
/api/stripe/prices ØªÙØ±Ø¬Ø¹ 4 Ø¹Ù†Ø§ØµØ± Ø¨Ø¯Ù‚Ø©: Daily 1.49, Weekly 5.99, Monthly 16.99, Yearly 99.99 Ù…Ù† Price IDs ÙÙŠ ENV.

Gender UI: Ù…ÙƒÙˆÙ‘Ù† Ù…ÙˆØ­Ù‘Ø¯ Ù„Ù„Ø±Ù…ÙˆØ² ÙˆØ§Ù„Ø£Ù„ÙˆØ§Ù† Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„Ù‡ÙˆÙ… ÙˆØ£ÙŠ Ù…ÙƒØ§Ù† Ø¢Ø®Ø±.

VIP: Ø±ÙØ¶ Ø³ÙŠØ±ÙØ±ÙŠ Ù„Ø·Ù„Ø¨ Prev Ø¹Ù†Ø¯ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø¬Ù„Ø³Ø© Ø£Ùˆ Ø¹Ø¯Ù… VIP.

Ø§Ù„Ø¨Ù†Ø§Ø¡ ÙŠÙ†Ø¬Ø­.

0) Ø³ÙƒØ±Ø¨Øª Ø¯Ø¹Ù… Ø¹Ø§Ù…: Ø¥Ù†Ø´Ø§Ø¡ ÙØ±Ø¹ ÙˆÙ†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ
cat > step00_branch_backup.sh <<'SH'
#!/usr/bin/env bash
set -Eeuo pipefail
TS="$(date +%Y%m%d-%H%M%S)"
BR="feat/auth-stripe-vip-${TS}"
BK="_ops/backups/${BR}"
mkdir -p "$BK"
git rev-parse --abbrev-ref HEAD > "$BK/base_branch.txt" || true
for f in \
  src/app/api/auth/\[\.\.\.nextauth\]/route.ts \
  src/components/HeaderLite.tsx \
  src/app/api/stripe/prices/route.ts \
  src/components/home/HomeClient.tsx \
  src/app/chat/ChatClient.tsx \
  src/app/api/match/next/route.ts \
; do [ -f "$f" ] && install -D "$f" "$BK/$f" || true; done
git checkout -b "$BR"
echo "-- Acceptance --"; echo "BRANCH_NEW=$BR"; echo "BACKUP_DIR=$BK"; echo "-- End Acceptance --"
SH
chmod +x step00_branch_backup.sh
bash _ops/bin/ops_run.sh ./step00_branch_backup.sh

1) Ø¥ØµÙ„Ø§Ø­ NextAuth + Ø±Ø¨Ø· Ø§Ù„Ù‡ÙŠØ¯Ø± Ø¨Ø§Ù„Ø­Ø§Ù„Ø©
1.1 Ù‚Ø±Ø§Ø¡Ø©/ØªØ­Ø¯ÙŠØ« Ø±Ø§ÙˆØª Ø§Ù„Ø£ÙˆØ« Ø¥Ù† Ù„Ø²Ù…

Ù…ØªØ·Ù„Ø¨Ø§Øª ENV Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©: NEXTAUTH_URL, NEXTAUTH_SECRET, GOOGLE_CLIENT_ID, GOOGLE_CLIENT_SECRET, AUTH_TRUST_HOST=true.

cat > step01_fix_auth_route.sh <<'SH'
#!/usr/bin/env bash
set -Eeuo pipefail
ROUTE="src/app/api/auth/[...nextauth]/route.ts"
test -f "$ROUTE" || { echo "route-missing"; exit 1; }

# Ø±Ù‚Ù‘Ø¹ Ø§Ù„Ù…Ø²ÙˆØ¯Ø§Øª Ø¨Ø´Ø±ÙˆØ· Ø¢Ù…Ù†Ø© ÙˆÙ„Ø§ ØªØ±Ù…Ù Ø£Ø®Ø·Ø§Ø¡ Ø¹Ù†Ø¯ ØºÙŠØ§Ø¨ Google
perl -0777 -pe '
  s/import\s+Google\s+from\s+["\']next-auth\/providers\/google["\'];?/import Google from "next-auth\/providers\/google";/s;
  s/export\s+const\s+authOptions[\s\S]*?} as const;/(() => {
    const providers:any[] = [];
    if (process.env.GOOGLE_CLIENT_ID && process.env.GOOGLE_CLIENT_SECRET) {
      providers.push(Google({ clientId: process.env.GOOGLE_CLIENT_ID!, clientSecret: process.env.GOOGLE_CLIENT_SECRET! }));
    }
    return { providers } as const;
  })();/s;
' -i "$ROUTE" || true

# ØªØ£ÙƒØ¯ Ù…Ù† ØªØµØ¯ÙŠØ± handlers Ø¨ØµÙŠØºØ© NextAuth v4/v5
grep -q 'export const { GET, POST }' "$ROUTE" || \
  perl -0777 -pe 's/export default .+?;?//s' -i "$ROUTE"

# Ù„Ø§ Ù†ØªØ¯Ø®Ù„ Ø£ÙƒØ«Ø±. Ø§Ù„Ø¨Ù†Ø§Ø¡ Ø³ÙŠÙƒØ´Ù Ø£ÙŠ Ù…Ø´Ø§ÙƒÙ„.
echo "-- Acceptance --"; echo "AUTH_ROUTE_PATCHED=1"; echo "-- End Acceptance --"
SH
chmod +x step01_fix_auth_route.sh
bash _ops/bin/ops_run.sh ./step01_fix_auth_route.sh

1.2 Ø±Ø¨Ø· Ø§Ù„Ù‡ÙŠØ¯Ø± Ø¨Ù€ useSession ÙˆØ¹Ø±Ø¶ 18+
cat > step01b_patch_header_session.sh <<'SH'
#!/usr/bin/env bash
set -Eeuo pipefail
HDR="src/components/HeaderLite.tsx"
test -f "$HDR" || { echo "header-missing"; exit 1; }

perl -0777 -pe '
  s/^("use client";\s*)?/ "use client"; /e;
  s/import\s+Link\s+from\s+["\']next\/link["\'];?/import Link from "next\/link"; import { useSession } from "next-auth\/react";/s;
' -i "$HDR" || true

# Ø£Ø¯Ø®Ù„ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø­Ø§Ù„Ø© Ø¥Ù† Ù„Ù… ØªÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø©
grep -q 'useSession' "$HDR" || exit 0
awk '
/function HeaderLite/ { inComp=1 }
{ print }
/return \(/ && inComp==1 && inserted!=1 {
  print "  const { data: session } = useSession();";
  inserted=1
}
END{}' "$HDR" > "$HDR.tmp" && mv "$HDR.tmp" "$HDR"

# Ø¨Ø¯Ù‘Ù„ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙŠÙ…ÙŠÙ†: 18+ Ø«Ø§Ø¨Øª + Login/Signout Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©
perl -0777 -pe '
  s/<div className="flex items-center gap-2">[\s\S]*?<\/div>/<div className="flex items-center gap-3">
    <span className="text-red-500 font-semibold text-sm">18\+<\/span>
    {session?.user ? (
      <>
        <span className="text-sm text-neutral-300">{session.user.email ?? "Account"}</span>
        <a href="\/api\/auth\/signout" className="px-3 py-1 rounded bg-neutral-800 border border-neutral-700 text-sm">Sign out<\/a>
      </>
    ) : (
      <a href="\/api\/auth\/signin" className="px-3 py-1 rounded bg-neutral-800 border border-neutral-700 text-sm">Sign in<\/a>
    )}
  <\/div>/s;
' -i "$HDR" || true

echo "-- Acceptance --"; echo "HEADER_SESSION_WIRED=1"; echo "-- End Acceptance --"
SH
chmod +x step01b_patch_header_session.sh
bash _ops/bin/ops_run.sh ./step01b_patch_header_session.sh

1.3 ØªØ­Ù‚Ù‚ Ø¥Ù†ØªØ§Ø¬ Ù„Ù„Ø£ÙˆØ«
cat > step01c_auth_accept.sh <<'SH'
#!/usr/bin/env bash
set -Eeuo pipefail
BASE="${DITONA_BASE:-https://www.ditonachat.com}"
PROV="$(curl -fsS "$BASE/api/auth/providers" || true)"
HDRS="$(curl -fsSI "$BASE/api/auth/signin" || true)"
STAT=$(echo "$HDRS" | awk "BEGIN{s=0} /^HTTP/{s=\$2} END{print s}")
CSRF=$(echo "$HDRS" | grep -qi "set-cookie:.*next-auth\.csrf-token" && echo 1 || echo 0)
echo "-- Acceptance --"
echo "PROVIDERS_LEN=$(printf %s "$PROV" | wc -c | awk "{print \$1}")"
echo "SIGNIN_STATUS=${STAT:-0}"
echo "SET_CSRF_COOKIE=$CSRF"
echo "-- End Acceptance --"
SH
chmod +x step01c_auth_accept.sh
bash _ops/bin/ops_run.sh ./step01c_auth_accept.sh


Ø¥Ù† Ø¨Ù‚ÙŠØª 500: Ø£Ø¨Ù„Øº Ø£Ù† Google OAuth ØºÙŠØ± Ù…ÙƒØªÙ…Ù„: ØªØ£ÙƒØ¯ Ù…Ù† Redirect URI ÙÙŠ Google:
https://www.ditonachat.com/api/auth/callback/google
ÙˆØªØ­Ù‚Ù‚ Ù…Ù† NEXTAUTH_URL ÙˆNEXTAUTH_SECRET Ø¹Ù„Ù‰ Vercel.

2) Stripe: ØªÙØ¹ÙŠÙ„ 4 Ø£Ø³Ø¹Ø§Ø± Ù…Ù† ENV
2.1 Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø±Ø§ÙˆØª /api/stripe/prices
cat > step02_patch_stripe_prices.sh <<'SH'
#!/usr/bin/env bash
set -Eeuo pipefail
ROUTE="src/app/api/stripe/prices/route.ts"
install -D /dev/null "$ROUTE"
cat > "$ROUTE" <<'TS'
import { NextResponse } from "next/server";
import Stripe from "stripe";

export const runtime = "nodejs";

function normalize(p: Stripe.Price) {
  return {
    id: p.id,
    amount: typeof p.unit_amount === "number" ? p.unit_amount : 0,
    currency: (p.currency || "usd").toLowerCase(),
    interval: (p.recurring?.interval || "month")
  };
}

export async function GET() {
  const ids = [
    process.env.STRIPE_BOOST_ME_DAILY_ID,
    process.env.STRIPE_PRO_WEEKLY_ID,
    process.env.STRIPE_VIP_MONTHLY_ID,
    process.env.STRIPE_ELITE_YEARLY_ID,
  ].filter(Boolean) as string[];

  // ÙˆØ¶Ø¹ ENV Ø§Ù„Ù…Ø­Ø¯Ø¯ ÙÙ‚Ø·
  if (ids.length === 4 && process.env.STRIPE_SECRET_KEY) {
    const stripe = new Stripe(process.env.STRIPE_SECRET_KEY!, { apiVersion: "2024-06-20" });
    const prices: any[] = [];
    for (const id of ids) {
      try { prices.push(normalize(await stripe.prices.retrieve(id))); } catch { /* skip */ }
    }
    if (prices.length === 4) return NextResponse.json({ prices });
  }

  // Fallback Ù‚Ø¯ÙŠÙ…: basic ÙÙ‚Ø·
  return NextResponse.json({ prices: [{ id: "basic", amount: 999, currency: "usd", interval: "month" }] });
}
TS
echo "-- Acceptance --"; echo "PRICES_ROUTE_WRITTEN=1"; echo "-- End Acceptance --"
SH
chmod +x step02_patch_stripe_prices.sh
bash _ops/bin/ops_run.sh ./step02_patch_stripe_prices.sh

2.2 ØªØ­Ù‚Ù‚ Ø¥Ù†ØªØ§Ø¬
cat > step02b_prices_accept.sh <<'SH'
#!/usr/bin/env bash
set -Eeuo pipefail
BASE="${DITONA_BASE:-https://www.ditonachat.com}"
JSON="$(curl -fsS "$BASE/api/stripe/prices" || true)"
N=$(echo "$JSON" | tr -d '\n' | sed -E 's/.*"prices":\[(.*)\].*/\1/' | awk -F'}' '{print NF-1}')
echo "-- Acceptance --"
echo "PRICES_COUNT=${N:-0}"
echo "SAMPLE=$(echo "$JSON" | tr -d '\n' | cut -c1-240)"
echo "-- End Acceptance --"
SH
chmod +x step02b_prices_accept.sh
bash _ops/bin/ops_run.sh ./step02b_prices_accept.sh


Ø¥Ù† ÙƒØ§Ù† PRICES_COUNT<4: Ø§Ø¶Ø¨Ø· Ø¹Ù„Ù‰ Vercel Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø£Ø±Ø¨Ø¹ Ù„Ù€Ù€ Price IDs.

3) Ù…ÙƒÙˆÙ‘Ù† GenderBadge Ù…ÙˆØ­Ù‘Ø¯ ÙˆØ§Ø³ØªØ®Ø¯Ø§Ù…Ù‡
cat > step03_gender_badge.sh <<'SH'
#!/usr/bin/env bash
set -Eeuo pipefail
DST="src/components/ui/GenderBadge.tsx"
install -D /dev/null "$DST"
cat > "$DST" <<'TS'
"use client";
import React from "react";

type G = "male" | "female" | "couple" | "lgbt";
export function GenderBadge({ g, size="lg" }: { g: G; size?: "sm"|"md"|"lg"|"xl" }) {
  const map: Record<G,{label:string; symbol:React.ReactNode; className:string}> = {
    male:   { label:"Male",   symbol:"â™‚", className:"text-blue-600" },
    female: { label:"Female", symbol:"â™€", className:"text-red-600" },
    couple: { label:"Couple", symbol:"âš¥", className:"text-red-400" },
    lgbt:   { label:"LGBT",   symbol:(<><span className="bg-gradient-to-r from-red-500 via-orange-400 via-yellow-400 via-green-500 via-blue-500 to-purple-600 bg-clip-text text-transparent">ğŸ³ï¸â€ğŸŒˆ âš§</span></>), className:"" },
  };
  const sz = { sm:"text-sm", md:"text-base", lg:"text-lg", xl:"text-xl" }[size];
  const item = map[g];
  return <span className={`inline-flex items-center gap-1 ${sz}`} aria-label={item.label}>
    <span className={item.className} aria-hidden>{item.symbol}</span>
    <span className={item.className}>{item.label}</span>
  </span>;
}
export default GenderBadge;
TS

# Ø¥Ø¯Ø±Ø§Ø¬ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ Ø§Ù„Ù‡ÙˆÙ… Ø¥Ù† Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ù‹Ø§
HC="src/components/home/HomeClient.tsx"
grep -q 'GenderBadge' "$HC" || perl -0777 -pe '
  s/import\s+Link\s+from\s+["\']next\/link["\'];?/import Link from "next\/link"; import GenderBadge from "@\/components\/ui\/GenderBadge";/s;
  s/â™‚ Male/<GenderBadge g="male" \/>/g;
  s/â™€ Female/<GenderBadge g="female" \/>/g;
  s/âš¥ Couple/<GenderBadge g="couple" \/>/g;
  s/ğŸ³ï¸â€ğŸŒˆ âš§ LGBT/<GenderBadge g="lgbt" \/>/g;
' -i "$HC" || true

echo "-- Acceptance --"; echo "GENDER_BADGE_ADDED=1"; echo "-- End Acceptance --"
SH
chmod +x step03_gender_badge.sh
bash _ops/bin/ops_run.sh ./step03_gender_badge.sh

4) VIP Ø­Ø§Ø±Ø³ Ø³ÙŠØ±ÙØ±ÙŠ Ù„Ø·Ù„Ø¨ Prev

ÙŠÙØ±Ø³Ù„ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù‡ÙŠØ¯Ø± x-ditona-prev: 1 Ø¹Ù†Ø¯ Prev. Ù†Ù…Ù†Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù… Ø¥Ø°Ø§ Ù„Ø§ Ø¬Ù„Ø³Ø© Ø£Ùˆ Ù„ÙŠØ³ VIP (Ù…Ø¤Ù‚ØªÙ‹Ø§ Ù†Ù…Ù†Ø¹ Ø¹Ù†Ø¯ ØºÙŠØ§Ø¨ Ø§Ù„Ø¬Ù„Ø³Ø© ÙÙ‚Ø·).

cat > step04_vip_prev_guard.sh <<'SH'
#!/usr/bin/env bash
set -Eeuo pipefail
ROUTE="src/app/api/match/next/route.ts"
test -f "$ROUTE" || { echo "route-missing"; exit 1; }

# Ø£Ø¯Ø®Ù„ ÙØ­Øµ prev Ø¹Ø¨Ø± Ø§Ù„Ù‡ÙŠØ¯Ø±
perl -0777 -pe '
  s/export async function GET\((req:[^)]+)\)\s*{/
export async function GET($1) {
  const prev = (req.headers.get("x-ditona-prev") === "1");
  if (prev) {
    try {
      const { getServerSession } = await import("next-auth");
      const session = await getServerSession();
      if (!session) { return new Response("prev requires auth", { status: 403 }); }
    } catch { return new Response("prev requires auth", { status: 403 }); }
  }
/s;
' -i "$ROUTE" || true

echo "-- Acceptance --"; echo "VIP_PREV_SERVER_GUARD=1"; echo "-- End Acceptance --"
SH
chmod +x step04_vip_prev_guard.sh
bash _ops/bin/ops_run.sh ./step04_vip_prev_guard.sh

5) ÙØ­Øµ Ù†Ù‡Ø§Ø¦ÙŠ + ÙØªØ­ PR
cat > step05_final_accept_push.sh <<'SH'
#!/usr/bin/env bash
set -Eeuo pipefail
BASE="${DITONA_BASE:-https://www.ditonachat.com}"

# auth
PROV="$(curl -fsS "$BASE/api/auth/providers" || true)"
HDRS="$(curl -fsSI "$BASE/api/auth/signin" || true)"
SIGNIN=$(echo "$HDRS" | awk "BEGIN{s=0} /^HTTP/{s=\$2} END{print s}")
CSRF=$(echo "$HDRS" | grep -qi "set-cookie:.*next-auth\.csrf-token" && echo 1 || echo 0)

# stripe
PR_JSON="$(curl -fsS "$BASE/api/stripe/prices" || true)"
PR_COUNT=$(echo "$PR_JSON" | tr -d '\n' | sed -E 's/.*"prices":\[(.*)\].*/\1/' | awk -F'}' '{print NF-1}')

echo "-- Acceptance --"
echo "AUTH_PROVIDERS_LEN=$(printf %s "$PROV" | wc -c | awk '{print $1}')"
echo "AUTH_SIGNIN_STATUS=${SIGNIN:-0}"
echo "AUTH_SET_CSRF=$CSRF"
echo "STRIPE_PRICES_COUNT=${PR_COUNT:-0}"
echo "-- End Acceptance --"

git add -A
git commit -m "Auth wiring, Stripe prices via ENV IDs, GenderBadge, server prev guard"
git push -u origin HEAD || true
echo "PR_URL=https://github.com/Alshughriahmed/diton/compare/main...$(git rev-parse --abbrev-ref HEAD)?expand=1"
SH
chmod +x step05_final_accept_push.sh
bash _ops/bin/ops_run.sh ./step05_final_accept_push.sh

*********************************    ØªØ¹Ù„ÙŠÙ…Ø§Øª Ù„Ù„ÙˆÙƒÙŠÙ„

Ù†ÙÙ‘Ø° â€œÙ‚Ø±Ø§Ø¡Ø©/ÙƒØªØ§Ø¨Ø©â€ Ø¨Ø­Ø°Ø± Ø¹Ø¨Ø± Ø§Ù„Ù€wrapper ÙÙ‚Ø·.

Ø£Ù†Ø´Ø¦ ÙØ±Ø¹Ù‹Ø§ ÙˆÙ†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.

Ù„Ø§ ØªØºÙŠÙ‘Ø± Ø£ÙŠ ENV.

Ø£Ø¹ÙØ¯ ÙÙ‚Ø· ÙƒØªÙ„Ø© Ø§Ù„Ù‚Ø¨ÙˆÙ„.

Ø£Ù…Ø± ÙˆØ§Ø­Ø¯ Ù„Ù„ØªÙ†ÙÙŠØ° ÙÙŠ Ø§Ù„Ø´ÙŠÙ„
# create + run
cat > step_auth_pages_create_v1.sh <<'SH'
#!/usr/bin/env bash
set -Eeuo pipefail
TS="$(date +%Y%m%d-%H%M%S)"
BR="feat/auth-pages-${TS}"
BK="_ops/backups/${BR}"; mkdir -p "$BK"

# 0) Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ù„Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©
for f in \
  src/app/api/auth/\[\.\.\.nextauth\]/route.ts \
  src/components/HeaderLite.tsx \
; do [ -f "$f" ] && install -D "$f" "$BK/$f" || true; done

# 1) ÙØ±Ø¹ Ø¬Ø¯ÙŠØ¯
git checkout -b "$BR" >/dev/null 2>&1 || true

# 2) Ù…ÙƒÙˆÙ‘Ù† Ø¹Ù…ÙŠÙ„ Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„
install -D /dev/null src/components/auth/LoginClient.tsx
cat > src/components/auth/LoginClient.tsx <<'TS'
"use client";
import Link from "next/link";
import { signIn } from "next-auth/react";

export default function LoginClient({title="Sign in to DitonaChat"}:{title?:string}) {
  const gradient = "bg-gradient-to-r from-violet-400 via-fuchsia-400 to-pink-400 bg-clip-text text-transparent";
  return (
    <main className="min-h-[70vh] w-full flex items-center justify-center px-4 py-24">
      <article className="w-full max-w-md rounded-2xl bg-neutral-900/70 border border-neutral-800 shadow-xl backdrop-blur p-6">
        <h1 className={`text-3xl font-extrabold tracking-tight ${gradient}`}>{title}</h1>
        <p className="mt-1 text-sm text-neutral-400">
          <span className="text-red-500 font-semibold">18+</span> Only. By continuing you agree to{" "}
          <Link className="underline hover:text-neutral-200" href="/terms">Terms</Link> and{" "}
          <Link className="underline hover:text-neutral-200" href="/privacy">Privacy</Link>.
        </p>
        <button
          onClick={() => signIn("google")}
          className="mt-6 w-full h-11 rounded-xl bg-white text-neutral-900 font-semibold hover:bg-neutral-100 transition"
          aria-label="Continue with Google"
        >
          Continue with Google
        </button>
        <a href="/api/auth/signin" className="sr-only">Fallback sign in</a>
        <p className="mt-6 text-xs text-neutral-500 text-center">
          Trouble signing in? Contact <a className="underline" href="mailto:info@ditonachat.com">info@ditonachat.com</a>
        </p>
      </article>
    </main>
  );
}
TS

# 3) ØµÙØ­Ø© /login (Ø®Ø§Ø¯Ù…ÙŠØ© Ù…Ø¹ metadata)
install -D /dev/null src/app/login/page.tsx
cat > src/app/login/page.tsx <<'TS'
import LoginClient from "@/components/auth/LoginClient";

export const metadata = {
  title: "Login | DitonaChat",
  description: "Sign in to DitonaChat to access chat, filters, and VIP features.",
  alternates: { canonical: "/login" }
};

export default function Page() {
  return <LoginClient title="Sign in to DitonaChat" />;
}
TS

# 4) ØµÙØ­Ø© /signup (ØªØ¹ÙŠØ¯ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†ÙØ³ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©)
install -D /dev/null src/app/signup/page.tsx
cat > src/app/signup/page.tsx <<'TS'
import LoginClient from "@/components/auth/LoginClient";

export const metadata = {
  title: "Sign up | DitonaChat",
  description: "Create your account with Google and start chatting instantly.",
  alternates: { canonical: "/signup" }
};

export default function Page() {
  return <LoginClient title="Create your DitonaChat account" />;
}
TS

# 5) Ø±Ø¨Ø· NextAuth Ø¨ØµÙØ­Ø© /login Ø¨Ø¯Ù„ ØµÙØ­Ø© Ø§Ù„Ù…Ø²ÙˆØ¯ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
ROUTE="src/app/api/auth/[...nextauth]/route.ts"
if [ -f "$ROUTE" ]; then
  install -D "$ROUTE" "$BK/$ROUTE"
  # Ø£Ø¯Ø®Ù„ pages.signIn Ø¥Ù† Ù„Ù… ØªÙˆØ¬Ø¯
  perl -0777 -pe '
    s/({\s*providers\s*:\s*\[[\s\S]*?\]\,?)/$1 pages: { signIn: "\/login" },/s unless /pages:\s*{[^}]*signIn/s;
  ' -i "$ROUTE" || true
fi

# 6) ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‡ÙŠØ¯Ø± Ù„Ø±ÙˆØ§Ø¨Ø· /login Ùˆ /signup Ù…Ø¹ ÙƒØ´Ù Ø§Ù„Ø¬Ù„Ø³Ø©
HDR="src/components/HeaderLite.tsx"
if [ -f "$HDR" ]; then
  install -D "$HDR" "$BK/$HDR"
  # ØªØ£ÙƒØ¯ Ù…Ù† "use client" Ùˆ useSession
  perl -0777 -pe '
    s/^("use client";\s*)?/ "use client"; /e;
    s/import\s+Link\s+from\s+["\']next\/link["\'];?/import Link from "next\/link"; import { useSession } from "next-auth\/react";/s;
  ' -i "$HDR" || true

  # Ø£Ø¯Ø®Ù„ useSession Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¯Ø§Ù„Ø©
  awk '
  /function HeaderLite/ { inComp=1 }
  { print }
  /return \(/ && inComp==1 && inserted!=1 { print "  const { data: session } = useSession();"; inserted=1 }
  ' "$HDR" > "$HDR.tmp" && mv "$HDR.tmp" "$HDR"

  # Ø§Ø³ØªØ¨Ø¯Ù„ ÙƒØªÙ„Ø© Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙŠÙ…ÙŠÙ†
  perl -0777 -pe '
    s/<div className="flex items-center gap-2">[\s\S]*?<\/div>/<div className="flex items-center gap-3">
      <span className="text-red-500 font-semibold text-sm">18\+<\/span>
      {session?.user ? (
        <>
          <span className="text-sm text-neutral-300">{session.user.email ?? "Account"}</span>
          <a href="\/api\/auth\/signout" className="px-3 py-1 rounded bg-neutral-800 border border-neutral-700 text-sm">Sign out<\/a>
        </>
      ) : (
        <>
          <Link href="\/login" className="px-3 py-1 rounded bg-neutral-800 border border-neutral-700 text-sm">Login<\/Link>
          <Link href="\/signup" className="px-3 py-1 rounded bg-neutral-800 border border-neutral-700 text-sm">Sign up<\/Link>
        </>
      )}
    <\/div>/s;
  ' -i "$HDR" || true
fi

# 7) Ù‚Ø¨ÙˆÙ„ Ù…Ø¨Ø³Ù‘Ø·
echo "-- Acceptance --"
echo "BRANCH_NEW=$BR"
echo "BACKUP_DIR=$BK"
echo "LOGIN_PAGE=src/app/login/page.tsx"
echo "SIGNUP_PAGE=src/app/signup/page.tsx"
echo "LOGIN_CLIENT=src/components/auth/LoginClient.tsx"
echo "AUTH_ROUTE_PAGES_SIGNIN_SET=$([ -f "$ROUTE" ] && grep -q 'pages: { signIn: \"/login\" }' "$ROUTE" && echo 1 || echo 0)"
echo "HEADER_LINKS_UPDATED=$([ -f "$HDR" ] && grep -q '/login' "$HDR" && grep -q '/signup' "$HDR" && echo 1 || echo 0)"
echo "-- End Acceptance --"
SH
chmod +x step_auth_pages_create_v1.sh
bash _ops/bin/ops_run.sh ./step_auth_pages_create_v1.sh


Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ†ÙÙŠØ°:

Ø¥Ù† ÙƒØ§Ù†Øª /api/auth/signin Ù„Ø§ ØªØ²Ø§Ù„ 500 ÙØ§Ù„Ù…Ø´ÙƒÙ„Ø© OAuth/ENV Ø®Ø§Ø±Ø¬ Ø§Ù„ÙƒÙˆØ¯. ØªØ­Ù‚Ù‘Ù‚ Ù…Ù†:

NEXTAUTH_URL=https://www.ditonachat.com

NEXTAUTH_SECRET Ù‚ÙˆÙŠ

Google OAuth: Authorized redirect URI = https://www.ditonachat.com/api/auth/callback/google

Ø¹Ù†Ø¯ Ù†Ø¬Ø§Ø­ Ø§Ù„Ù…Ø²ÙˆÙ‘Ø¯ Ø³ØªØ¹Ù…Ù„ /login Ùˆ/signup Ø¨Ø£Ø²Ø±Ø§Ø± Google ÙˆÙŠØ¸Ù‡Ø± ØªØ¨Ø¯Ù‘Ù„ Ø§Ù„Ø­Ø§Ù„Ø© ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.