(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[457],{2728:(e,t,r)=>{Promise.resolve().then(r.bind(r,8027))},8027:(e,t,r)=>{"use strict";r.d(t,{default:()=>h});var a=r(6087),l=r(4863);let s=new Map,n=(e,t)=>(s.has(e)||s.set(e,new Set),s.get(e).add(t),()=>s.get(e).delete(t)),i=(e,t)=>{var r;null==(r=s.get(e))||r.forEach(e=>e(t))},o={stream:null,micOn:!0,camOn:!0,facing:"user"};async function c(){if(o.stream)return o.stream;let e=await navigator.mediaDevices.getUserMedia({audio:!0,video:{facingMode:o.facing}});return o.stream=e,e}async function u(){var e;o.facing="user"===o.facing?"environment":"user";let t=await navigator.mediaDevices.getUserMedia({audio:!0,video:{facingMode:o.facing}});return null==(e=o.stream)||e.getTracks().forEach(e=>e.stop()),o.stream=t,t}let d=e=>{let t,r=new Set,a=(e,a)=>{let l="function"==typeof e?e(t):e;if(!Object.is(l,t)){let e=t;t=(null!=a?a:"object"!=typeof l||null===l)?l:Object.assign({},t,l),r.forEach(r=>r(t,e))}},l=()=>t,s={setState:a,getState:l,getInitialState:()=>n,subscribe:e=>(r.add(e),()=>r.delete(e))},n=t=e(a,l,s);return s},b=e=>{let t=(e=>e?d(e):d)(e),r=e=>(function(e,t=e=>e){let r=l.useSyncExternalStore(e.subscribe,l.useCallback(()=>t(e.getState()),[e,t]),l.useCallback(()=>t(e.getInitialState()),[e,t]));return l.useDebugValue(r),r})(t,e);return Object.assign(r,t),r},p=(e=>e?b(e):b)(e=>({gender:"all",countries:[],isVip:!1,setVip:t=>e({isVip:!!t}),setGender:t=>e(e=>e.isVip?{gender:t}:{gender:"all"}),setCountries:t=>e(e=>e.isVip?{countries:(null==t?void 0:t.length)?t.slice(0,15):[]}:{countries:[]}),reset:()=>e({gender:"all",countries:[]})})),g="\uD83D\uDE00\uD83D\uDE04\uD83D\uDE01\uD83D\uDE06\uD83E\uDD79\uD83D\uDE0A\uD83D\uDE42\uD83D\uDE09\uD83D\uDE0D\uD83D\uDE18\uD83D\uDE1C\uD83E\uDD2A\uD83E\uDD17\uD83E\uDD14\uD83E\uDD28\uD83D\uDE10\uD83D\uDE34\uD83E\uDD73\uD83E\uDD29\uD83D\uDE0E\uD83D\uDE07\uD83D\uDE2D\uD83D\uDE24\uD83D\uDE21\uD83D\uDC4D\uD83D\uDC4E\uD83D\uDC4F\uD83D\uDE4F\uD83D\uDCAA\uD83D\uDD25✨\uD83C\uDF89❤️\uD83E\uDDE1\uD83D\uDC9B\uD83D\uDC9A\uD83D\uDC99\uD83D\uDC9C\uD83D\uDDA4\uD83E\uDD0D\uD83D\uDCAF✅❌".split("");function m(e){let{onPick:t}=e;return(0,a.jsx)("div",{"data-testid":"emoji-panel",className:"absolute bottom-14 left-2 z-50 grid grid-cols-8 gap-2 p-2 rounded-2xl bg-neutral-900/95 shadow-lg border border-neutral-700",children:g.map((e,r)=>(0,a.jsx)("button",{onClick:()=>t(e),className:"text-xl hover:scale-110 transition","aria-label":"emoji ".concat(e),children:e},r))})}function x(e){let{onSend:t}=e,[r,s]=(0,l.useState)(""),[n,i]=(0,l.useState)(!1),o=(0,l.useRef)(null),{isVip:c}=function(){let[e,t]=(0,l.useState)(!1),[r,a]=(0,l.useState)({level:"guest"});return(0,l.useEffect)(()=>{let e=!0;return(async()=>{try{let r=await fetch("/api/user/vip-status",{cache:"no-cache",headers:{"Cache-Control":"no-cache"}});if(!r.ok)throw Error("VIP status check failed");let l=await r.json();e&&(t(l.isVip||!1),a(l.status||{level:"guest"}))}catch(r){console.error("Failed to check VIP status:",r),e&&(t(!1),a({level:"guest"}))}})(),()=>{e=!1}},[]),{isVip:e,vipStatus:r,isLoading:!1,error:null}}(),u=e=>{e.preventDefault(),r.trim()&&(t(r.trim()),s(""))};return(0,a.jsxs)("div",{className:"relative p-4 bg-gray-800 border-t border-gray-700",children:[n&&(0,a.jsx)(m,{onPick:e=>{let t=o.current;if(!t)return;let r=t.selectionStart||t.value.length,a=t.selectionEnd||r;s(t.value.slice(0,r)+e+t.value.slice(a)),t.focus(),setTimeout(()=>{t.selectionStart=t.selectionEnd=r+e.length},0),i(!1)}}),(0,a.jsxs)("form",{onSubmit:u,className:"flex gap-2",children:[(0,a.jsx)("input",{type:"text",value:r,onChange:e=>s(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),u(e))},"data-testid":"chat-input",ref:o,placeholder:"Type a message…",className:"flex-1 px-4 py-2 bg-gray-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",maxLength:500}),(0,a.jsx)("button",{type:"button","data-testid":"emoji-button",onClick:e=>{e.preventDefault(),i(e=>!e)},className:"px-3 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"\uD83D\uDE00"}),(0,a.jsx)("button",{type:"submit",disabled:!r.trim(),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"إرسال"})]})]})}function h(){var e;let{next:t,prev:r}=function(){let e=(0,l.useRef)(0),t=(0,l.useRef)(!1),r=(0,l.useCallback)(()=>{let r=Date.now();return!(r-e.current<700)&&!t.current&&(e.current=r,!0)},[]);return{next:(0,l.useCallback)(async()=>{if(r()){t.current=!0;try{i("ui:next"),await fetch("/api/match/next",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"next"})})}catch(e){console.debug("[NEXT_ERROR]",e)}finally{t.current=!1}}},[r]),prev:(0,l.useCallback)(async()=>{if(r()){t.current=!0;try{i("ui:prev"),await fetch("/api/match/next",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"prev"})})}catch(e){console.debug("[PREV_ERROR]",e)}finally{t.current=!1}}},[r])}}(),s=(0,l.useRef)(0),d=(0,l.useRef)(!1),b=(0,l.useRef)(null),[g,m]=(0,l.useState)(!1),[h,f]=(0,l.useState)(!1),[v,y]=(0,l.useState)(0),[j,N]=(0,l.useState)(123),[w,C]=(0,l.useState)(null),{gender:D,countries:S,setGender:k,setCountries:E,isVip:O,setVip:R}=p(),[L,P]=(0,l.useState)(!1);async function V(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];let e=Date.now();if(d.current||e-s.current<700)return;d.current=!0,s.current=e;let t=new URLSearchParams;t.set("gender",D),S.length&&t.set("countries",S.join(","));let r=await fetch("/api/match/next?"+t.toString(),{cache:"no-store"}).then(e=>e.json()).catch(()=>null);r&&C(r),d.current=!1}return(0,l.useEffect)(()=>{let e=e=>{let t=e.key.toLowerCase();"arrowright"===t||"n"===t?i("ui:next"):"arrowleft"===t||"p"===t?i("ui:prev"):"m"===t?i("ui:toggleMic"):"c"===t?i("ui:toggleCam"):"s"===t&&i("ui:openSettings")};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]),(0,l.useEffect)(()=>{let e=n("ui:toggleMic",()=>{let e=o.stream;e&&(o.micOn=!o.micOn,e.getAudioTracks().forEach(e=>e.enabled=o.micOn),o.micOn)}),a=n("ui:toggleCam",()=>{let e=o.stream;e&&(o.camOn=!o.camOn,e.getVideoTracks().forEach(e=>e.enabled=o.camOn),o.camOn)}),l=n("ui:openSettings",()=>{}),s=n("ui:like",()=>{f(e=>!e),y(e=>e?Math.max(0,e-1):e+1)}),i=n("ui:report",()=>{}),u=n("ui:next",()=>{t(),V()}),d=n("ui:prev",()=>{r(),V(!0)});return c().then(()=>{let e=o.stream;b.current&&e&&(b.current.srcObject=e,b.current.muted=!0,b.current.play().catch(()=>{})),m(!0)}).catch(()=>{}),fetch("/api/user/vip-status").then(e=>e.json()).then(e=>R(!!e.isVip)).catch(()=>{}),()=>{e(),a(),l(),s(),i(),u(),d()}},[]),(0,l.useEffect)(()=>{let e=0,t=0,r=0,a=0,l=r=>{let a=r.touches[0];e=a.clientX,t=a.clientY},s=l=>{let s=l.touches[0];r=s.clientX-e,a=s.clientY-t},n=()=>{Math.abs(r)>80&&60>Math.abs(a)&&(r<0?i("ui:next"):i("ui:prev")),e=t=r=a=0},o=document.getElementById("gesture-layer");if(o)return o.addEventListener("touchstart",l,{passive:!0}),o.addEventListener("touchmove",s,{passive:!0}),o.addEventListener("touchend",n),()=>{o.removeEventListener("touchstart",l),o.removeEventListener("touchmove",s),o.removeEventListener("touchend",n)}},[]),(0,a.jsx)("div",{className:"min-h-screen h-screen w-full bg-gradient-to-b from-slate-900 to-slate-950 text-slate-100",children:(0,a.jsxs)("div",{className:"h-full grid grid-rows-2 gap-2 p-2",children:[(0,a.jsxs)("section",{className:"relative rounded-2xl bg-black/30 overflow-hidden",children:[(0,a.jsxs)("div",{className:"absolute top-2 left-2 flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-slate-700 border border-slate-500","aria-label":"Peer avatar"}),(0,a.jsxs)("span",{className:"px-2 py-0.5 rounded-full bg-rose-600/20 border border-rose-500 text-xs",children:["♥ ",j]}),O&&(0,a.jsx)("span",{className:"px-2 py-0.5 rounded-full bg-amber-500/20 border border-amber-400 text-xs",children:"VIP"})]}),(0,a.jsxs)("div",{className:"absolute top-2 right-2 flex items-center gap-2",children:[(0,a.jsx)("div",{className:"relative",children:(0,a.jsxs)("details",{className:"group",children:[(0,a.jsxs)("summary",{className:"px-3 py-1.5 rounded-full bg-slate-800/80 border border-slate-600 text-xs cursor-pointer",children:["\uD83C\uDF10 Countries (",S.length||"0",")"]}),(0,a.jsxs)("div",{className:"absolute right-0 mt-2 w-64 max-h-64 overflow-auto rounded-xl bg-slate-900/95 border border-slate-700 p-2 space-y-1",children:[(0,a.jsx)("input",{placeholder:"Search…",className:"w-full mb-2 px-2 py-1 rounded bg-slate-800 border border-slate-700 text-xs outline-none",onChange:e=>{let t=e.target.value.toLowerCase();document.querySelectorAll("[data-cc]").forEach(e=>{e.style.display=e.dataset.cc.includes(t)?"":"none"})}}),(0,a.jsx)("div",{className:"grid grid-cols-3 gap-1",children:["US","DE","FR","GB","TR","AE","SA","EG","JO","IQ","SY","LB","MA","ZA","BR","AR","ES","IT","SE","NO","RU","CN","JP","KR","IN","PK","BD","ID","PH","TH","VN","IR","CA","AU","NZ"].map(e=>(0,a.jsx)("button",{"data-cc":e.toLowerCase(),onClick:t=>{t.preventDefault(),E(S.includes(e)?S.filter(t=>t!==e):[...S,e])},className:"text-xs px-2 py-1 rounded border "+(S.includes(e)?"bg-emerald-700/40 border-emerald-500":"bg-slate-800 border-slate-700"),children:e},e))})]})]})}),(0,a.jsx)("div",{className:"relative",children:(0,a.jsxs)("details",{className:"group",children:[(0,a.jsxs)("summary",{className:"px-3 py-1.5 rounded-full bg-slate-800/80 border border-slate-600 text-xs cursor-pointer",children:["Gender: ",D[0].toUpperCase()+D.slice(1)]}),(0,a.jsx)("div",{className:"absolute right-0 mt-2 w-40 rounded-xl bg-slate-900/95 border border-slate-700 p-1",children:["all","male","female","couple","lgbt"].map(e=>(0,a.jsx)("button",{className:"w-full text-left text-xs px-2 py-1 rounded "+(D===e?"bg-emerald-700/40":"hover:bg-slate-800"),onClick:t=>{t.preventDefault(),k(e)},children:e[0].toUpperCase()+e.slice(1)},e))})]})})]}),(0,a.jsxs)("div",{className:"absolute bottom-2 left-2 flex flex-wrap items-center gap-2 text-xs",children:[(0,a.jsx)("span",{className:"px-2 py-1 rounded-full bg-slate-800/70 border border-slate-600",children:(null==w||null==(e=w.countries)?void 0:e[0])||"—"}),(0,a.jsx)("span",{className:"px-2 py-1 rounded-full bg-slate-800/70 border border-slate-600",children:"City"}),(0,a.jsx)("span",{className:"px-2 py-1 rounded-full bg-slate-800/70 border border-slate-600",children:((null==w?void 0:w.gender)||"all").toUpperCase()})]}),(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center text-slate-300/80 text-sm select-none",children:"Remote peer area (states: connecting/matched/…)"})]}),(0,a.jsxs)("section",{className:"relative rounded-2xl bg-black/20 overflow-hidden",children:[(0,a.jsx)("video",{"data-local-video":!0,ref:b,className:"w-full h-full object-cover",playsInline:!0}),!g&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center text-slate-300 text-sm",children:"Requesting camera/mic…"}),(0,a.jsxs)("div",{className:"absolute top-2 right-2 flex items-center gap-2",children:[(0,a.jsx)("button",{"aria-label":"Switch Camera",className:"px-3 py-1.5 rounded-full bg-slate-800/80 border border-slate-600 text-xs",onClick:async e=>{e.preventDefault();let t=await u();b.current&&t&&(b.current.srcObject=t,b.current.play().catch(()=>{}))},children:"↺"}),(0,a.jsx)("button",{"aria-label":"Beauty",className:"px-3 py-1.5 rounded-full border text-xs "+(L?"bg-fuchsia-700/30 border-fuchsia-500":"bg-slate-800/80 border-slate-600"),onClick:e=>{e.preventDefault(),P(e=>!e)},children:"✨"}),O&&(0,a.jsx)("span",{className:"px-2 py-0.5 rounded-full bg-amber-500/20 border border-amber-400 text-xs",children:"VIP"})]}),(0,a.jsx)("div",{className:"absolute inset-x-0 bottom-14",children:(0,a.jsx)(x,{onSend:e=>{console.log("Message sent:",e)}})}),(0,a.jsx)("div",{className:"absolute inset-x-2 bottom-2",children:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,a.jsx)("button",{"aria-label":"Prev",className:"px-5 py-2 rounded-full bg-neutral-800 text-white text-sm border border-neutral-700",onClick:e=>{e.preventDefault(),i("ui:prev")},children:"⏮️ Prev"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{"aria-label":"Mic",className:"px-3 py-2 rounded-lg bg-neutral-800 border border-neutral-700",onClick:e=>{e.preventDefault(),i("ui:toggleMic")},children:"\uD83C\uDF99️"}),(0,a.jsx)("button",{"aria-label":"Camera",className:"px-3 py-2 rounded-lg bg-neutral-800 border border-neutral-700",onClick:e=>{e.preventDefault(),i("ui:toggleCam")},children:"\uD83D\uDCF7"}),(0,a.jsx)("button",{"aria-label":"Speaker",className:"px-3 py-2 rounded-lg bg-neutral-800 border border-neutral-700",children:"\uD83D\uDD0A"}),(0,a.jsx)("button",{"aria-label":"Settings",className:"px-3 py-2 rounded-lg bg-neutral-800 border border-neutral-700",onClick:e=>{e.preventDefault(),i("ui:openSettings")},children:"⚙️"}),(0,a.jsx)("button",{"aria-label":"Report",className:"px-3 py-2 rounded-lg bg-neutral-800 border border-neutral-700",onClick:e=>{e.preventDefault(),i("ui:report")},children:"\uD83D\uDEE1️"}),(0,a.jsxs)("button",{"aria-label":"Like",className:"px-3 py-2 rounded-lg border "+(h?"bg-rose-600/40 border-rose-400":"bg-neutral-800 border-neutral-700"),onClick:e=>{e.preventDefault(),i("ui:like")},children:["♥ ",v]})]}),(0,a.jsx)("button",{"aria-label":"Next",className:"px-5 py-2 rounded-full bg-emerald-600 text-white text-sm border border-emerald-500",onClick:e=>{e.preventDefault(),i("ui:next")},children:"Next ⏭️"})]})}),(0,a.jsx)("div",{id:"gesture-layer",className:"absolute inset-0 -z-10"})]})]})})}}},e=>{e.O(0,[642,369,358],()=>e(e.s=2728)),_N_E=e.O()}]);